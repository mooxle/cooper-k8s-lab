# Ansible Inventory Configuration

> Production-ready Ansible inventory for Cooper'n'80s Proxmox nodes

## ðŸŽ¯ Overview

The Ansible inventory defines all Proxmox nodes with enterprise-grade configuration patterns including SSH key authentication, Vault integration, and Wake-on-LAN capabilities.

## ðŸ“‹ Inventory Structure

### File Location
```
~/cooper-lab/ansible/inventory/proxmox.yml
```

### Complete Inventory Template

```yaml
---
all:
  children:
    proxmox_nodes:
      hosts:
        cooper-node-01:
          ansible_host: 10.0.1.10
          ansible_user: root
          ansible_python_interpreter: /usr/bin/python3
          vault_node_path: cooper-n-80s/environments/dev/nodes/cooper-node-01
          ansible_ssh_private_key_file: /home/USERNAME/.ssh/cooper-node-01_key
          vmbr1_ip: 10.0.10.1
          wol_mac: "AA:BB:CC:DD:EE:FF"
          wol_broadcast: "10.0.1.255"
        
        cooper-node-02:
          ansible_host: 10.0.1.11
          ansible_user: root
          ansible_python_interpreter: /usr/bin/python3
          vault_node_path: cooper-n-80s/environments/dev/nodes/cooper-node-02
          ansible_ssh_private_key_file: /home/USERNAME/.ssh/cooper-node-02_key
          vmbr1_ip: 10.0.10.2
          wol_mac: "AA:BB:CC:DD:EE:FF"
          wol_broadcast: "10.0.1.255"
        
        cooper-node-03:
          ansible_host: 10.0.1.12
          ansible_user: root
          ansible_python_interpreter: /usr/bin/Python3
          vault_node_path: cooper-n-80s/environments/dev/nodes/cooper-node-03
          ansible_ssh_private_key_file: /home/USERNAME/.ssh/cooper-node-03_key
          vmbr1_ip: 10.0.10.3
          wol_mac: "AA:BB:CC:DD:EE:FF"
          wol_broadcast: "10.0.1.255"
      
      vars:
        ansible_ssh_common_args: '-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null'
```

## ðŸ”§ Configuration Parameters

### Per-Node Variables

| Variable | Purpose | Example | Notes |
|----------|---------|---------|-------|
| `ansible_host` | Node IP address | `10.0.1.10` | DHCP reservation required |
| `vault_node_path` | Vault secrets path | `cooper-n-80s/environments/dev/nodes/cooper-node-01` | Per-node credential storage |
| `ansible_ssh_private_key_file` | SSH key location | `/home/user/.ssh/cooper-node-01_key` | Generated by Terraform |
| `vmbr1_ip` | VM bridge IP | `10.0.10.1` | Internal VM network gateway |
| `wol_mac` | Wake-on-LAN MAC | `aa:bb:cc:dd:ee:ff` | For power management |
| `wol_broadcast` | WOL broadcast IP | `10.0.1.255` | Network broadcast address |

### Global Variables

| Variable | Purpose | Value |
|----------|---------|-------|
| `ansible_user` | SSH user | `root` | Enterprise admin pattern |
| `ansible_python_interpreter` | Python path | `/usr/bin/python3` | Debian/Proxmox standard |
| `ansible_ssh_common_args` | SSH options | `'-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null'` | Lab-optimized SSH |

## ðŸ” Security Configuration

### SSH Key Authentication
- **Per-node SSH keys**: Each node has unique Ed25519 key pair
- **Vault-managed keys**: Private keys stored securely in HashiCorp Vault
- **No password authentication**: SSH keys only for security

### Vault Integration
- **Dynamic secrets**: Credentials generated per deployment
- **Structured paths**: Organized by environment and node
- **Audit trail**: All secret access logged

## ðŸŽ® Power Management

### Wake-on-LAN Configuration
- **MAC Address Discovery**: Use `ip link show` on each node
- **Network Broadcast**: Lab VLAN broadcast address
- **Power Control**: Automated startup/shutdown capabilities

### MAC Address Discovery
```bash
# On each Proxmox node
ip link show | grep -E "enp|eth" -A1 | grep "link/ether"
```

## ðŸš€ Usage Examples

### Basic Connectivity Test
```bash
# Test all nodes
ansible -i inventory/proxmox.yml proxmox_nodes -m ping

# Test specific node
ansible -i inventory/proxmox.yml cooper-node-01 -m ping
```

### System Information
```bash
# Gather facts from all nodes
ansible -i inventory/proxmox.yml proxmox_nodes -m setup

# Check Proxmox version
ansible -i inventory/proxmox.yml proxmox_nodes -m command -a "pveversion"
```

### Service Status
```bash
# Check critical services
ansible -i inventory/proxmox.yml proxmox_nodes -m systemd -a "name=pveproxy state=started"
```

## ðŸ”§ Maintenance Operations

### SSH Key Rotation
```bash
# Extract new keys from Vault (after Terraform update)
vault kv get -format=json cooper-n-80s/environments/dev/nodes/cooper-node-01 | \
  jq -r '.data.data.ssh_private_key' > ~/.ssh/cooper-node-01_key
chmod 600 ~/.ssh/cooper-node-01_key
```

### Inventory Validation
```bash
# Verify inventory syntax
ansible-inventory -i inventory/proxmox.yml --list

# Test connectivity with verbose output
ansible -i inventory/proxmox.yml proxmox_nodes -m ping -v
```

## ðŸ“Š Network Architecture

### IP Address Allocation

| Node | Management IP | VM Bridge IP | Purpose |
|------|---------------|--------------|---------|
| Node-01 | 10.0.1.10 | 10.0.10.1 | Control+Worker |
| Node-02 | 10.0.1.11 | 10.0.10.2 | Worker |
| Node-03 | 10.0.1.12 | 10.0.10.3 | Worker |

### Network Services Integration
- **DNS Registration**: Automatic registration in cooper.lab domain
- **DHCP Reservations**: Static IP assignments via MAC address
- **Service Discovery**: Hostname resolution for automation

---

**Status**: âœ… **OPERATIONAL** - Production-ready inventory with enterprise patterns  
**Security**: SSH key authentication only, Vault-integrated secrets management  
**Integration**: Compatible with all Cooper'n'80s automation playbooks